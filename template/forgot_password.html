<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Forgot Password</title>
  <!-- <link rel="stylesheet" href="/staticfile/main.css"/> -->
</head>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  }

  body {
    background: #f5f7fa;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }

  .container {
    background: #fff;
    padding: 2.5rem 2rem;
    border-radius: 10px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
  }

  h2 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #333;
  }

  .input-group {
    margin-bottom: 1rem;
  }

  input[type="email"],
  input[type="text"],
  input[type="password"] {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid #ccc;
    border-radius: 8px;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.3s;
  }

  input:focus {
    border-color: #007bff;
  }

  button {
    width: 100%;
    padding: 0.75rem 1rem;
    font-size: 1rem;
    border: none;
    border-radius: 8px;
    background-color: #007bff;
    color: white;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-top: 0.5rem;
  }

  button:hover {
    background-color: #0056b3;
  }

  #otpSection {
    margin-top: 1.5rem;
  }

    
    #snackbar {
    min-width: 250px;
    max-width: 80%;
    background-color: #d32f2f;
    color: #fff;
    border-radius: 4px;
    padding: 10px 14px 10px 40px;
    position: fixed;
    top: 40px;
    font-size: 14px;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transform: translateX(0);
    transition: transform 0.4s ease, opacity 0.3s ease, visibility 0.3s;
    }

    /* Slide-in from LEFT (used for Signup) */
    #snackbar.slide-left {
    left: 10px;
    right: auto;
    transform: translateX(-100%);
    }
    #snackbar.slide-left.show {
    transform: translateX(0);
    opacity: 1;
    visibility: visible;
    }
    #snackbar.slide-left.hide {
    transform: translateX(-100%);
    opacity: 0;
    visibility: hidden;
    }

    /* Slide-in from RIGHT (used for Signin) */
    #snackbar.slide-right {
    right: 10px;
    left: auto;
    transform: translateX(100%);
    }
    #snackbar.slide-right.show {
    transform: translateX(0);
    opacity: 1;
    visibility: visible;
    }
    #snackbar.slide-right.hide {
    transform: translateX(100%);
    opacity: 0;
    visibility: hidden;
    }

    /* Snackbar icon base */
    .snackbar-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: white;
    position: relative;
    flex-shrink: 0;
    }

    /* Reset both pseudo-elements */
    .snackbar-icon::before,
    .snackbar-icon::after {
    content: none;
    }

    /* Error (X) */
    .snackbar-icon.error::before,
    .snackbar-icon.error::after {
    content: "";
    position: absolute;
    width: 12px;
    height: 2px;
    background-color: #d32f2f;
    top: 50%;
    left: 50%;
    transform-origin: center;
    }

    .snackbar-icon.error::before {
    transform: translate(-50%, -50%) rotate(45deg);
    }

    .snackbar-icon.error::after {
    transform: translate(-50%, -50%) rotate(-45deg);
    }

    /* Success (✓) */
    /* .snackbar-icon.success::before {
    content: "";
    position: absolute;
    width: 6px;
    height: 2px;
    background-color: #4caf50;
    top: 12px;
    left: 6px;
    transform: rotate(-45deg);
    }

    .snackbar-icon.success::after {
    content: "";
    position: absolute;
    width: 12px;
    height: 2px;
    background-color: #4caf50;
    top: 10px;
    left: 4px;
    transform: rotate(45deg);
    } */

    .back-btn {
    display: inline-block;
    margin-bottom: 1.5rem;
    background-color: transparent;
    color: #111317;
    border: none;
    font-size: 0.95rem;
    cursor: pointer;
    transition: color 0.3s, background-color 0.3s;
    padding: 0;
    text-align: left;
    }

    .back-btn:hover {
    color: #111317;
    background-color: transparent; /* Ensure no background on hover */
    text-decoration: underline;
    }







  @keyframes fadein {
    from { bottom: 10px; opacity: 0; }
    to { bottom: 30px; opacity: 1; }
  }

  @keyframes fadeout {
    from { bottom: 30px; opacity: 1; }
    to { bottom: 10px; opacity: 0; }
  }

  @media (max-width: 480px) {
    .container {
      margin: 1rem;
      padding: 2rem 1.25rem;
    }

    h2 {
      font-size: 1.5rem;
    }

    button {
      font-size: 0.95rem;
    }

    input {
      font-size: 0.95rem;
    }
  }
</style>

<body>
  <div class="container">
    <div id="snackbar" class="slide-right">
        <span class="snackbar-icon" id="snackbar-icon"></span>
        <span id="snackbar-message"></span>
    </div>

    <button id="backHomeBtn" class="back-btn">← Back to Signin</button>


    <h2>Forgot Password</h2>
    <form id="forgotForm">
      <div class="input-group">
        <input type="email" id="email" placeholder="Enter your registered email" required />
      </div>
      <button type="submit">Send OTP</button>
    </form>

    <div id="otpSection" style="display:none;">
      <div class="input-group">
        <input type="text" id="otp" placeholder="Enter OTP" required />
      </div>
      <div class="input-group">
        <input type="password" id="newPassword" placeholder="New Password" required />
      </div>
      <button id="resetBtn">Reset Password</button>
    </div>
  </div>

  <script>
    // Wrap async logic in an IIFE
   
      document.getElementById("backHomeBtn").onclick = () => {
        window.location.href = "/signin";
    };
    document.getElementById("forgotForm").onsubmit = async (e) => {
        e.preventDefault();
        const email = document.getElementById("email").value;
        try {
            const res = await fetch("/forgot-password/send-otp", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email })
            });

            const data = await res.json();
            showSnackbar(data.message || "Email is not valid!!", res.ok);

            if (res.ok) {
                document.getElementById("otpSection").style.display = "block";
            }
        } catch (err) {
            showSnackbar("Failed to send OTP. Try again.", false);
        }
    };

    document.getElementById("resetBtn").onclick = async () => {
        const otp = document.getElementById("otp").value;
        const password = document.getElementById("newPassword").value;
        const email = document.getElementById("email").value;
        try {
            const res = await fetch("/forgot-password/reset", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ email, otp, password })
            });

            const data = await res.json();
            showSnackbar(data.message || data.detail || "Unknown response", res.ok);

            if (res.ok) {
                setTimeout(() => window.location.href = "/signin", 2000);
            }
        } catch (err) {
            showSnackbar("Reset failed. Please try again.", false);
        }
    };

    function showSnackbar(message, isSuccess = true) {
        const snackbar = document.getElementById("snackbar");
        const icon = document.getElementById("snackbar-icon");
        const msg = document.getElementById("snackbar-message");

        msg.textContent = message || (isSuccess ? "Success!" : "Error!");

        if (isSuccess) {
            icon.style.display = "none"; // hide icon
        } else {
            icon.style.display = "inline-flex"; // show icon
            icon.className = "snackbar-icon error"; // apply error styling
        }

        snackbar.classList.add("show");
        snackbar.style.backgroundColor = isSuccess ? "#4caf50" : "#f44336";

        setTimeout(() => {
            snackbar.classList.remove("show");
        }, 3000);
        }

  
  
    </script>
</body>
</html>
